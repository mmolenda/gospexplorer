function injectHtml(e,t){d3.select(e).html(t).style("color",colorBlue1).transition().duration("500").style("color",colorBlue8)}function boxMouseOver(e,t){highlightGroup(e.group)}function boxMouseOut(e,t){unhighlightGroup(e.group)}function highlightGroup(e){for(i=0;i<e.length;i++){d3.selectAll(".grp-"+e[i]+":not(.selected)").style("stroke-width",2).transition().duration(150).style("stroke",colorBlue6)}}function unhighlightGroup(e){for(i=0;i<e.length;i++){d3.selectAll(".grp-"+e[i]+":not(.selected)").style("stroke-width",1).transition().duration(150).style("stroke",colorBlue2)}}function unselectSelected(){d3.selectAll("rect.selected").classed("selected",false).style("stroke",colorBlue2).style("stroke-width",1)}function selectGroup(e){unselectSelected();for(i=0;i<e.length;i++){d3.selectAll(".grp-"+e[i]).classed("selected",true).style("stroke-width",2).transition().duration(500).style("stroke",colorRed2)}}function getNextCoordinates(e,t,n){var r=null;if(n>2){return r}var i=e[t];for(var s=n+1;s<i.length;s++){if(i[s]!=null){return{x:s,y:i[s]}}}return r}function truncate(e){var t=28;if(e.length>t)return e.substring(0,t)+"...";else return e}function showContents(e,t){var n=[];var r={};for(i=0;i<t.length;i++){var s=d3.selectAll("rect.grp-"+t[i]);for(j=0;j<s[0].length;j++){var o=d3.select(s[0][j]).data()[0].ref;n.push(o);r[o]=d3.select(s[0][j]).data()[0].title}}var u="";for(i=0;i<n.length;i++){var o=n[i];u+='<div class="paragraph">';u+="<h1>";u+=r[o].toUpperCase()+" ("+o+")";u+="</h1>";u+="<p>";u+=e[o];u+="</p>";u+="</div>"}var a=document.getElementById("paragraphs");a.scrollTop=0;injectHtml(a,u)}function visualizeData(e,t){function v(r,i){selectGroup(r.group);showContents(t,r.group);var s=d3.transform(d3.select("g#grp-"+r.book).attr("transform"))["translate"][1];for(var o=0;o<e.length;o++){var u=d3.select("g#grp-"+o);var a=n[r.group[0]][o];if(r.book==o||a==null){continue}var f=(i-a)*(barHeight+barPaddingHorizontal)+s;u.transition().attr("transform","translate(0,"+f+")")}}var n={};var r={};for(var i=0;i<e.length;i++){var s=e[i];for(var o=0;o<s.length;o++){var u=s[o];for(var a=0;a<u.group.length;a++){var f=u.group[a];if(r[f]===undefined){r[f]=0}if(n[f]===undefined){n[f]=[null,null,null,null]}r[f]++;n[f][i]=o}}}var l=d3.select("#leftpane").append("svg").attr("width",w).attr("height",h);var c=d3.behavior.drag().origin(function(){var e=this;return{x:d3.transform(e.getAttribute("transform")).translate[0],y:d3.transform(e.getAttribute("transform")).translate[1]}}).on("drag",function(e,t){var n=this;translate=d3.transform(n.getAttribute("transform")).translate;x=d3.event.dx+translate[0],y=d3.event.dy+translate[1];var r=d3.select(n).attr("id");d3.select("g#"+r).attr("transform","translate("+0+","+(d3.event.dy+translate[1])+")");d3.event.sourceEvent.stopPropagation()});var p=[];for(var d=0;d<e.length;d++){p.push(l.append("g").attr("id","grp-"+d).call(c).attr("transform","translate(0, 0)"))}for(var d=0;d<e.length;d++){p[d].selectAll("rect.i"+d).data(e[d]).enter().append("rect").attr("x",function(e,t){return barPaddingVertical+d*(barWidth+barPaddingVertical)}).attr("y",function(e,t){return t*(barHeight+barPaddingHorizontal)}).attr("rx",3).attr("ry",3).attr("width",barWidth).attr("height",barHeight).attr("group",function(e,t){return e.group}).attr("class",function(e,t){var n=[];for(var t=0;t<e.group.length;t++){n.push("grp-"+e.group[t])}return n.join(" ")}).attr("fill",function(e,t){var n=[];for(t=0;t<e.group.length;t++){n.push(r[e.group[t]])}return e.group?frequencyColors[Math.max.apply(Math,n)]:colorBlue1}).on("mouseover",boxMouseOver).on("mouseout",boxMouseOut).on("click",v,"a","b")}for(var d=0;d<e.length;d++){p[d].selectAll("text.i"+d).data(e[d]).enter().append("text").text(function(e){return truncate(e.ref+" "+e.title)}).attr("text-anchor","left").attr("x",function(e,t){return barPaddingVertical+d*(barWidth+barPaddingVertical)+5}).attr("y",function(e,t){return t*(barHeight+barPaddingHorizontal)+barHeight*.65}).attr("font-family","sans-serif").attr("font-size","11px").attr("fill",colorBlue8).on("mouseover",boxMouseOver).on("mouseout",boxMouseOut).on("click",v)}d3.select("a#title").on("click",function(){d3.event.preventDefault();window.scrollTo(0,0);unselectSelected();injectHtml("#paragraphs",intro);d3.selectAll("g").transition().duration(125).attr("transform","translate(0,0)")})}var __version__=null;var barPaddingHorizontal=10;var barPaddingVertical=20;var barWidth=200;var barHeight=20;var labelOffsetVertical=10;var labelOffsetHorizontal=10;var colorBlue1="#f7f8fa";var colorBlue2="#e3e4e6";var colorBlue3="#cfd0d1";var colorBlue4="#b8b9ba";var colorBlue5="#a4a5a6";var colorBlue6="#909191";var colorBlue7="#797a7a";var colorBlue8="#5b5b5c";var colorRed2="#b61a01";var w=920;var h=(barHeight+barPaddingHorizontal)*200;var frequencyColors={1:colorBlue1,2:colorBlue2,3:colorBlue3,4:colorBlue4};var intro=""+"<p>"+'<span style="color: #b61a01">PRZEZNACZENIEM</span> tego narzędzia jest wizualizacja ewangelii pod względem struktury i współwystępowania poszczególnych fragmentów oraz ułatwienie czytania powiązanych fragmentów<br /><br />'+'<span style="color: #b61a01">INTENSYWNOŚĆ</span> koloru jest proporcjonalna do liczby wystąpień danego fragmentu w ewangeliach - im ciemniejszy kolor w tym większej liczbie ewangelii dany fragment występuje<br /><br />'+'<span style="color: #b61a01">KLIKNIJ</span> wybrany fragment, aby pokazać jego treść oraz powiązane fragmenty z pozostałych ewangelii<br /><br />'+'<span style="color: #b61a01">PRZECIĄGNIJ</span> wybraną ewangelię w pionie aby zmienić jej pozycję względem pozostałych<br /><br />'+'<span style="color: #b61a01">WSZYSTKIE</span> cytaty pochodzą z Biblii Tysiąclecia<br /><br />'+'<span style="color: #b61a01">AD MAIOREM DEI GLORIAM</span>'+"</p>";injectHtml("#paragraphs",intro);d3.select("#leftpane").html("Loading...");d3.json("data/bt_titles.json",function(e,t){if(e!=null){alert("Cannot load the data - titles");return}d3.json("data/bt_contents.json",function(e,n){if(e!=null){alert("Cannot load the data - contents");return}d3.select("#leftpane").html("");visualizeData(t,n)})})